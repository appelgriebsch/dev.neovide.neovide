id: dev.neovide.neovide
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: neovide
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=host
  - --share=network
build-options:
  env:
    neovim_bin: /app/bin/nvim
modules:
  - modules/neovim.yml
  - name: host-spawn
    buildsystem: simple
    build-commands:
      - install -Dm755 host-spawn /app/bin/host-spawn
    sources:
      - type: file
        url: https://github.com/1player/host-spawn/releases/download/v1.6.0/host-spawn-x86_64
        sha256: 75159f0d3924a0bd6d230c6414d19ad44609b5a16671db6624681c910f9bb4ff
        dest-filename: host-spawn
  - name: neovide
    sources:
      - type: git
        url: https://github.com/neovide/neovide
        commit: 9c23c432b8105f39d9e9ddc2732d3350a0323cc9
        dest: repo
      - type: archive
        url: https://github.com/neovide/neovide/releases/download/0.13.3/neovide-linux-x86_64.tar.gz
        sha256: 767e18a196aa6d3d8208fd75c89eb87ef35409dedd25c72f4caf57aba9526615
        strip-components: 0
      - type: file
        path: dev.neovide.neovide.metainfo.xml
    buildsystem: simple
    build-commands:
      - install -Dm644 repo/assets/neovide.desktop /app/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 repo/assets/neovide.svg /app/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - desktop-file-edit --set-icon="${FLATPAK_ID}" /app/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 dev.neovide.neovide.metainfo.xml /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
      - install -Dm755 neovide -t /app/bin

